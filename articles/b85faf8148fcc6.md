---
title: "KubernetesにアプリをデプロイするためのHelm Chart作成手順まとめ"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

本記事は、KubernetesおよびHelmを初めて触る方向けに、最小限の構成でアプリケーションをデプロイする手順をまとめたものです。

# はじめに
Kubernetes（K8s）は、コンテナ化されたアプリケーションを運用するためのツールです。しかし、その運用には多くの設定ファイル（マニフェスト）を書く必要があり、初見では、理解するのが大変困難です。私も現職で初めてK8sに触れており、最初は理解に苦しみました。

また、設定ファイルの再利用性を考慮したときに、Helmが役に立ちます。Helmは「Kubernetesのパッケージマネージャー」として知られていますが、実際には「設定ファイルをテンプレート化し、環境ごとに柔軟に変化させて使える仕組み」を提供する強力なツールです。

# Kubernetesのマニフェストとは
Kubernetesにおけるマニフェスト（manifest）とは、Kubernetesクラスタに対して「どういう構成で、どのようにアプリケーションを動かしたいのか」を伝えるための設定ファイルのことです。
基本的に YAML形式で記述され、Kubernetesのリソース（Pod, Deployment, Service など）を宣言的に定義します。

## Deploymentの最小構成

```yaml:deployment.yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
        - name: my-app
          image: nginx:latest
          ports:
            - containerPort: 80
```


```bash
$ kubectl apply -f deployment.yaml
```

## Serviceの最小構成
```yaml:service.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-app
spec:
  selector:
    app: my-app
  ports:
    - port: 80
      targetPort: 80
  type: NodePort
```

```bash
$ kubectl apply -f service.yaml
```
## Ingressの最小構成

```yaml:ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-app-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
    - host: myapp.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: my-app
                port:
                  number: 80
```

```bash
$ kubectl apply -f ingress.yaml
```

## 動作確認
```bash
kubectl get pods
kubectl get svc
```

# Helmとは
Helmは、Kubernetes用のパッケージマネージャーです。
Helmは kubectl apply では煩雑になりがちな複数リソースの管理を1つの単位として扱えるようにする便利なツールです。

# Helm Chartとは
Helm Chart は、HelmでアプリケーションをKubernetesにデプロイするための**「ひとまとまりのテンプレート定義ファイル」**です。
Chart はざっくり言えば「Kubernetesマニフェストをテンプレート化したディレクトリ構成」として以下のように構成されます：

# minikube上で確認
ここまでで、Kubernetesの設定ファイルと、HelmとHelm Chartの基本構造について学んできました。
いよいよ、作成したHelm Chartを使って ローカルのminikubeクラスタにアプリケーションをデプロイしてみましょう。

# まとめ
