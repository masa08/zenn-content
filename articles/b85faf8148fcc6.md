---
title: "Minikubeã§å‹•ã‹ã—ã¦å­¦ã¶Kubernetesã¨Helmå…¥é–€"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["kubernetes", "helm", "minikube"]
published: true
---

## ã¯ã˜ã‚ã«

æœ¬è¨˜äº‹ã¯ã€Kubernetesã¨Helmã«åˆã‚ã¦è§¦ã‚Œã‚‹æ–¹ã«å‘ã‘ã¦ã€ã§ãã‚‹ã ã‘ã‚ã‹ã‚Šã‚„ã™ãã€æœ€å°æ§‹æˆã§ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ã‚’ç´¹ä»‹ã™ã‚‹ã‚‚ã®ã§ã™ã€‚
ç­†è€…è‡ªèº«ã€ç¾åœ¨ã®è·å ´ã§Kubernetesã‚„Helmã‚’åˆã‚ã¦è§¦ã‚ŒãŸéš›ã€æœ€åˆã®ç†è§£ã«éå¸¸ã«è‹¦åŠ´ã—ã¾ã—ãŸã€‚ã“ã®è¨˜äº‹ã¯ã€ãã®ã¨ãã®ã€Œã©ã“ã§ã¤ã¾ãšã„ãŸã‹ã€ã€Œã©ã†ã™ã‚Œã°ç†è§£ãŒé€²ã‚“ã ã‹ã€ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€åŒã˜ã‚ˆã†ã«æ‚©ã‚€æ–¹ã®åŠ©ã‘ã«ãªã‚Œã°ã¨ã„ã†æ€ã„ã¨ã€è‡ªåˆ†ã®å‚™å¿˜éŒ²ã®æ„å‘³ã‚‚è¾¼ã‚ã¦æ›¸ã„ã¦ã„ã¾ã™ã€‚

## Kubernetes

Kubernetesã¯ã€ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã€å®£è¨€çš„ãªè¨­å®šã‚„è‡ªå‹•åŒ–ã‚’ç”¨ã„ãªãŒã‚‰ã€ç®¡ç†ã™ã‚‹ãŸã‚ã®ã€ãƒãƒ¼ã‚¿ãƒ–ãƒ«ã§æ‹¡å¼µå¯èƒ½ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚å…¬å¼ã‚µã‚¤ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå®šç¾©ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚

> Kubernetes is a portable, extensible, open source platform for managing containerized workloads and services, that facilitates both declarative configuration and automation. It has a large, rapidly growing ecosystem. Kubernetes services, support, and tools are widely available.

<https://kubernetes.io/docs/concepts/overview/>

Kubernetesã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã‚„åœæ­¢ã ã‘ã§ãªãã€å¿…è¦ã«å¿œã˜ãŸã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆPodã®å¢—æ¸›ï¼‰ã‚„éšœå®³ç™ºç”Ÿæ™‚ã®ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã‚‚è‡ªå‹•çš„ã«è¡Œã£ã¦ãã‚Œã‚‹ãŸã‚ã€å®‰å®šã—ãŸé‹ç”¨ã¨åŠ¹ç‡çš„ãªãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

Kubernetesã®ç†è§£ã‚’æ·±ã‚ã‚‹ã†ãˆã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã®åŸºæœ¬ã‚’æŠ¼ã•ãˆã¦ãŠãã¨ç†è§£ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã¯ã€ä»®æƒ³åŒ–æŠ€è¡“ã®ä¸€ã¤ã§ã€ã‚³ãƒ¼ãƒ‰ã‚„ãã®ä¾å­˜é–¢ä¿‚ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãªã©ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã©ã®ç’°å¢ƒã§ã‚‚åŒã˜ã‚ˆã†ã«å‹•ä½œã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚Kubernetesã¯ã€ã“ã†ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’åŠ¹ç‡çš„ã‹ã¤å®‰å®šçš„ã«é‹ç”¨ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

ä»¥ä¸‹ã«å…¬å¼ã‚µã‚¤ãƒˆã®ãƒªãƒ³ã‚¯ã‚’è²¼ã£ã¦ãŠãã¾ã™ãŒã€ãƒãƒƒãƒˆä¸Šã«å…ˆäººã®æ–¹ãŒæ›¸ã„ãŸè§£èª¬è¨˜äº‹ãªã©ã‚‚å¤šæ•°ã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’èª¿ã¹ã¦ã¿ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ä»Šå›ã®è¨˜äº‹ã§ã¯ã€Kubernetesã¨Helmã®ãƒ‡ãƒ—ãƒ­ã‚¤å‘¨ã‚Šã«ç„¦ç‚¹ã‚’å½“ã¦ãŸã„ã®ã§ã€èª¬æ˜ã¯çœãã¾ã™ã€‚

<https://www.docker.com/ja-jp/resources/what-container/>

## Kubernetes Objects

Kubernetesã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¨ã—ã¦å®£è¨€ã—ã€ãã‚Œã«åŸºã¥ã„ã¦ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãŒè‡ªå‹•çš„ã«ç®¡ç†ãƒ»èª¿æ•´ã•ã‚Œã¾ã™ã€‚
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã™ã¹ã¦YAMLï¼ˆã¾ãŸã¯JSONï¼‰å½¢å¼ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã•ã‚Œã€kubectl ã‚„ API çµŒç”±ã§Kubernetesã«é©ç”¨ã•ã‚Œã¾ã™ã€‚

> Kubernetes objects are persistent entities in the Kubernetes system. Kubernetes uses these entities to represent the state of your cluster.

<https://kubernetes.io/docs/concepts/overview/working-with-objects/>

ä»¥ä¸‹ãŒä¸»è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€è¦§ã§ã™ã€‚

| ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ                 | èª¬æ˜                              |
| ---------------------- | ------------------------------- |
| **Pod**                | ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹æœ€å°å˜ä½ï¼ˆé€šå¸¸ã¯1ã‚³ãƒ³ãƒ†ãƒŠï¼‰         |
| **Deployment**         | è¤‡æ•°ã®Podã‚’ä¸€è²«ã—ã¦ç®¡ç†ãƒ»ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ»æ›´æ–°         |
| **ReplicaSet**         | DeploymentãŒå†…éƒ¨ã§ä½¿ã†ã€Podã®ãƒ¬ãƒ—ãƒªã‚«ç¶­æŒæ©Ÿæ§‹   |
| **Service**            | Podã«å¯¾ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›            |
| **Ingress**            | å¤–éƒ¨ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€å†…éƒ¨ã®Serviceã¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| **ConfigMap / Secret** | ã‚¢ãƒ—ãƒªã®è¨­å®šå€¤ã‚„æ©Ÿå¯†æƒ…å ±ã‚’Podã«æ¸¡ã™ä»•çµ„ã¿          |

ã“ã‚Œã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã©ã®ã‚ˆã†ã«è¨˜è¿°ã—ã€é©ç”¨ã—ã¦ã„ãã‹ã¯ã€æ¬¡ã®ç« ã§ç´¹ä»‹ã™ã‚‹ã€Œãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã€ã®æ§‹é€ ã¨ã‚ã‚ã›ã¦å…·ä½“çš„ã«è¦‹ã¦ã„ãã¾ã™ã€‚

## ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

Kubernetesã§ã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ä¸Šã§å‹•ã‹ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æƒ…å ±ã‚’ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¨ã„ã†è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸»ã« YAMLå½¢å¼ ã§æ›¸ã‹ã‚Œã€Kubernetesã«ã€Œã“ã†ã„ã†çŠ¶æ…‹ã«ã—ã¦ã»ã—ã„ã€ã¨ä¼ãˆã‚‹ãŸã‚ã®å®£è¨€çš„ãªå®šç¾©ã§ã™ã€‚

> When you use the Kubernetes API to create the object (either directly or via kubectl), that API request must include that information as YAMLã€€orã€€JSON in the request body. Most often, you provide the information to kubectl in a file known as a manifest.

<https://kubernetes.io/docs/concepts/overview/working-with-objects/>

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ç‰¹å¾´ã¨ã—ã¦ã€ä»¥ä¸‹ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

1. å®£è¨€çš„ï¼ˆdeclarativeï¼‰
  ã€Œä½•ã‚’ã©ã†ã—ã¦ã»ã—ã„ã‹ã€ã‚’å®šç¾©ã™ã‚‹ã ã‘ã§ã€KubernetesãŒçŠ¶æ…‹ã‚’ç¶­æŒãƒ»èª¿æ•´ã—ã¦ãã‚Œã‚‹
2. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒå®¹æ˜“
  YAMLãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§Gitãªã©ã§å¤‰æ›´å±¥æ­´ã‚’ç®¡ç†ã—ã‚„ã™ã„
3. å†ç¾æ€§ãŒé«˜ã„
  åŒã˜ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’é©ç”¨ã™ã‚Œã°ã€ä»–ã®ç’°å¢ƒã§ã‚‚åŒã˜çŠ¶æ…‹ã‚’å†ç¾ã§ãã‚‹

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®åŸºæœ¬æ§‹é€ ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€å¿…é ˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ã€ä»¥ä¸‹ã‚’æŒã¡ã¾ã™ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | èª¬æ˜                                                                 |
|-----------------|----------------------------------------------------------------------|
| **apiVersion**  | ãã®ãƒªã‚½ãƒ¼ã‚¹ãŒä½¿ã† Kubernetes API ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³                       |
| **kind**        | ä½œæˆã—ãŸã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¨®é¡ï¼ˆä¾‹: Deployment, Service ãªã©ï¼‰         |
| **metadata**    | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåã€ãƒ©ãƒ™ãƒ«ã€Namespace ãªã©ã®è­˜åˆ¥æƒ…å ±                     |
| **spec**        | æœ›ã¾ã—ã„çŠ¶æ…‹ï¼ˆä¾‹: Pod æ•°ã€ã‚¤ãƒ¡ãƒ¼ã‚¸åã€ãƒãƒ¼ãƒˆãªã©ï¼‰ã‚’å…·ä½“çš„ã«è¨˜è¿°ã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ |

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 2
  # ã“ã“ã«Podã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆcontainersã€imageãªã©ï¼‰ã‚’å®šç¾©ã—ã¾ã™
```

ä½œæˆã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€kubectl apply ã‚³ãƒãƒ³ãƒ‰ã§Kubernetesã«é©ç”¨ã—ã¾ã™ï¼š

```bash
kubectl apply -f deployment.yaml
```

ã“ã‚Œã«ã‚ˆã‚Šã€Kubernetesã¯æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€æœ›ã¾ã—ã„çŠ¶æ…‹ã«ä¿ã¤ã‚ˆã†è‡ªå‹•ã§åˆ¶å¾¡ã‚’å§‹ã‚ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã©ã®ã‚ˆã†ã«è¨˜è¿°ã—ã€é©ç”¨ã—ã¦ã„ãã‹ã¯ã€Deploymentã¨ Serviceã€Ingressã®æ›¸ãæ–¹ã‚’ä¾‹ã¨ã—ã¦ã€ã“ã®å…ˆã®ç« ã§ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

### Deployment

Kubernetesã«ãŠã‘ã‚‹ Deployment ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹Podã‚’å®‰å®šçš„ã«ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã™ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ï¼š

> A Deployment manages a set of Pods to run an application workload, usually one that doesn't maintain state.

<https://kubernetes.io/docs/concepts/workloads/controllers/deployment/>

Deploymentã¯å†…éƒ¨çš„ã« ReplicaSet ã‚’åˆ©ç”¨ã—ã¦ã€æŒ‡å®šã—ãŸæ•°ã®Podã‚’å¸¸ã«ç¶­æŒã—ã€å¿…è¦ã«å¿œã˜ã¦å†èµ·å‹•ã‚„ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ˆæ®µéšçš„ãªæ›´æ–°ï¼‰ã‚’è¡Œã„ã¾ã™ã€‚ãã®ãŸã‚ã€å˜ãªã‚‹Podã®èµ·å‹•ã ã‘ã§ãªãã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ãƒ»ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ»ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã¨ã„ã£ãŸå®Ÿé‹ç”¨ã«æ¬ ã‹ã›ãªã„æ©Ÿèƒ½ã‚’æ”¯ãˆã¦ãã‚Œã‚‹é‡è¦ãªå­˜åœ¨ã§ã™ã€‚

```yaml:deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: proxy
  template:
    metadata:
      labels:
        app.kubernetes.io/name: proxy
    spec:
      containers:
      - name: nginx
        image: nginx:stable
        ports:
        - containerPort: 80
          name: http-web-svc

```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | èª¬æ˜                                                                 |
|-----------------|----------------------------------------------------------------------|
| **replicas**    | èµ·å‹•ã™ã‚‹Podã®æ•°ï¼ˆä¾‹ï¼š2ã¤ï¼‰                                           |
| **selector**    | ã“ã®DeploymentãŒç®¡ç†ã™ã‚‹Podã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®æ¡ä»¶                      |
| **template**    | å®Ÿéš›ã«ä½œæˆã•ã‚Œã‚‹Podã®ä»•æ§˜ã‚’å®šç¾©                                      |
| **containers**  | Podå†…ã§èµ·å‹•ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠï¼ˆã“ã“ã§ã¯nginxï¼‰                             |

ã“ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ deployment.yaml ã¨ã—ã¦ä¿å­˜ã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
kubectl apply -f deployment.yaml
```

ã“ã®ã‚ˆã†ã«ã€Deploymentã‚’ä½¿ã†ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ãƒ»ç¶­æŒãƒ»æ›´æ–°ã‚’Kubernetesã«ä»»ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ç« ã§ã¯ã€Podã«å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªServiceã®å®šç¾©ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

### Service

Kubernetesã«ãŠã‘ã‚‹ Service ã¯ã€è¤‡æ•°ã®Podã«å¯¾ã—ã¦å®‰å®šã—ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹ãŸã‚ã®æŠ½è±¡åŒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Podã¨ã—ã¦å‹•ã‹ã™å ´åˆã€Deploymentã®ä»•çµ„ã¿ã«ã‚ˆã£ã¦Podã¯å‹•çš„ã«ä½œæˆãƒ»å‰Šé™¤ã•ã‚Œã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚å¤‰ã‚ã‚Šã¾ã™ã€‚
ãã®ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒç›´æ¥Podã®IPã‚’æŒ‡å®šã—ã¦é€šä¿¡ã™ã‚‹ã®ã¯ç¾å®Ÿçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Serviceã¯ã€è¤‡æ•°ã®Podã‚’1ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã¾ã¨ã‚ã€ä»®æƒ³IPã‚„DNSåã‚’é€šã˜ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹â€œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®å…¥ã‚Šå£â€ã§ã™ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ï¼š

> Expose an application running in your cluster behind a single outward-facing endpoint, even when the workload is split across multiple backends.

<https://kubernetes.io/docs/concepts/services-networking/service/>

```yaml:service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app.kubernetes.io/name: proxy
  ports:
  - name: name-of-service-port
    protocol: TCP
    port: 80
    targetPort: http-web-svc
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰       | èª¬æ˜                                                                 |
|------------------|----------------------------------------------------------------------|
| **selector**     | ãƒ©ãƒ™ãƒ«ã«ã‚ˆã‚Šå¯¾è±¡Podã‚’æŒ‡å®šã€‚Deploymentã®Podã¨ä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹     |
| **port**         | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹Serviceã®ãƒãƒ¼ãƒˆ                            |
| **targetPort**   |  http-web-svc ã¯ã€Podå®šç¾©å†…ã®ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆã« name: http-web-svc ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ•°å€¤ï¼ˆä¾‹: 80ï¼‰ã§æ›¸ãã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚                              |

ã“ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ service.yaml ã¨ã—ã¦ä¿å­˜ã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
kubectl apply -f service.yaml
```

æ¬¡ç« ã§ã¯ã€URLãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚„è¤‡æ•°Serviceã®çµ±åˆå…¥ã‚Šå£ã¨ã—ã¦ä½¿ãˆã‚‹ Ingress ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

### Ingress

Kubernetesã«ãŠã‘ã‚‹ Ingress ã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿å¤–éƒ¨ã‹ã‚‰å†…éƒ¨ã®Serviceã¸HTTP/HTTPSã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯æ¬¡ã®ã‚ˆã†ã«èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

> Make your HTTP (or HTTPS) network service available using a protocol-aware configuration mechanism, that understands web concepts like URIs, hostnames, paths, and more. The Ingress concept lets you map traffic to different backends based on rules you define via the Kubernetes API.

<https://kubernetes.io/docs/concepts/services-networking/ingress/>

```yaml:ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nginx-ingress
spec:
  ingressClassName: nginx
  rules:
    - host: example.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: nginx-service
                port:
                  number: 80
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰                | èª¬æ˜                                      |
|---------------------------|-------------------------------------------|
| **ingressClassName**      | åˆ©ç”¨ã™ã‚‹ Ingress Controller ã®æŒ‡å®šï¼ˆä¾‹: `nginx`ï¼‰ |
| **rules**                 | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ›ã‚¹ãƒˆã‚„ãƒ‘ã‚¹ã«åŸºã¥ã„ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®å®šç¾©          |
| **backend.service**       | è©²å½“ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹Serviceã¨ãã®ãƒãƒ¼ãƒˆç•ªå·             |
| **pathType**              | `Prefix`ï¼ˆå‰æ–¹ä¸€è‡´ï¼‰ã‚„ `Exact`ï¼ˆå®Œå…¨ä¸€è‡´ï¼‰ãªã©ã®ãƒãƒƒãƒæ–¹å¼   |

ã“ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ ingress.yaml ã¨ã—ã¦ä¿å­˜ã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
kubectl apply -f ingress.yaml
```

â€»Gateway APIã«ã¤ã„ã¦
Kubernetesã§ã¯ã€Ingressã«ä»£ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã€ Gateway API ãŒç™»å ´ã—ã¦ã„ã¾ã™ã€‚

> Gateway API is a family of API kinds that provide dynamic infrastructure provisioning and advanced traffic routing.

ãªãŠã€Ingress NGINX Controllerã¯2025å¹´11æœˆã«å»ƒæ­¢ãŒäºˆå‘Šã•ã‚Œã€2026å¹´3æœˆä»¥é™ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚‚æä¾›ã•ã‚Œã¾ã›ã‚“ã€‚æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯Gateway APIï¼ˆEnvoy Gatewayã€Ciliumç­‰ï¼‰ã®æ¡ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

è©³ç´°ã¯ä»¥ä¸‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚
<https://kubernetes.io/docs/concepts/services-networking/gateway/>

## Helm

Kubernetesã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆï¼ˆDeploymentã€Serviceã€Ingressãªã©ï¼‰ã‚’è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚ŒãŒå¢—ãˆã¦ãã‚‹ã¨ã€è¨­å®šã®é‡è¤‡ã‚„ç’°å¢ƒå·®åˆ†ã®ç®¡ç†ãŒç…©é›‘ã«ãªã£ã¦ãã¾ã™ã€‚

Helm ã¯ã€ã“ã†ã—ãŸKubernetesã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã—ã¦ç®¡ç†ãƒ»å†åˆ©ç”¨ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã—ã‚„ã™ãã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã™ã€‚

å…¬å¼ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

> Helm helps you manage Kubernetes applications â€” Helm Charts help you define, install, and upgrade even the most complex Kubernetes application.

## Helm Chart

Helm Chartã¯ã€Kubernetesã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é›†åˆä½“ã§ã™ã€‚

> A Chart is a Helm package. It contains all of the resource definitions necessary to run an application, tool, or service inside of a Kubernetes cluster. Think of it like the Kubernetes equivalent of a Homebrew formula, an Apt dpkg, or a Yum RPM file.

ãƒãƒ£ãƒ¼ãƒˆã®æ§‹æˆã®ä¾‹

```bash
mychart/
  Chart.yaml            # ãƒãƒ£ãƒ¼ãƒˆã®ãƒ¡ã‚¿æƒ…å ±ï¼ˆåå‰ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ï¼‰
  values.yaml           # å¤‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ³¨å…¥ã•ã‚Œã‚‹ï¼‰
  templates/                # Kubernetesãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ ¼ç´ã•ã‚Œã‚‹
    deployment.yaml         # Podã®èµ·å‹•å®šç¾©ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“ï¼‰
    service.yaml            # Podã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®Serviceå®šç¾©
    ingress.yaml            # å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹Ingresså®šç¾©
```

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã¯ {{ .Values.image.repository }} ã®ã‚ˆã†ã« ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æ–‡ã‚’ç”¨ã„ã¦å€¤ã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»æœ¬ç•ªãªã©ã®ç’°å¢ƒã”ã¨ã«è¨­å®šã ã‘ã‚’å¤‰ãˆã¦åŒã˜ãƒãƒ£ãƒ¼ãƒˆã‚’ä½¿ã„å›ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

## minikubeä¸Šã§ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹

ãƒ­ãƒ¼ã‚«ãƒ«ã§ Kubernetes ã‚’è©¦ã™ã«ã¯ã€minikube ã‚’ä½¿ã†ã®ãŒæœ€ã‚‚æ‰‹è»½ã§ã™ã€‚ã“ã“ã§ã¯ Helm ã‚’ä½¿ã£ã¦ Nginx ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ minikube ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€Ingress çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«æ§‹ç¯‰ã—ã¾ã™ã€‚

minikubeã«é–¢ã—ã¦ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ä»¥ä¸‹ã®ã‚ˆã†ã«èª¬æ˜ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚

> minikube quickly sets up a local Kubernetes cluster on macOS, Linux, and Windows. We proudly focus on helping application developers and new Kubernetes users.

<https://minikube.sigs.k8s.io/docs/>

### minikube ã®èµ·å‹•

```bash
minikube start
```

å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã§ã‚¯ãƒ©ã‚¹ã‚¿ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚

```bash
kubectl get nodes
```

### Helm ãƒãƒ£ãƒ¼ãƒˆã®ä½œæˆ

```bash
helm create mychart
cd mychart
```

ç”Ÿæˆã•ã‚ŒãŸãƒãƒ£ãƒ¼ãƒˆæ§‹æˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```bash
mychart/
  Chart.yaml
  values.yaml
  templates/
    deployment.yaml
    service.yaml
    ingress.yaml
    ...
```

### values.yaml ã‚’ç·¨é›†

values.yaml ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ãƒ³ãƒ—ãƒ«åŒ–ã—ã¾ã™ã€‚

```yaml:values.yaml
replicaCount: 2

image:
  repository: nginx
  tag: stable
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: true
  className: nginx
  hosts:
    - host: example.local
      paths:
        - path: /
          pathType: Prefix
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†

å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```yaml:deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "mychart.fullname" . }}-deployment
spec:
  replicas: {{ .Values.replicaCount | default 1 }}
  selector:
    matchLabels:
      app.kubernetes.io/name: {{ include "mychart.name" . }}
  template:
    metadata:
      labels:
        app.kubernetes.io/name: {{ include "mychart.name" . }}
    spec:
      containers:
        - name: {{ .Chart.Name }}
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - containerPort: {{ .Values.service.port }}
              name: http-web-svc

```

```yaml:service.yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ include "mychart.fullname" . }}-service
spec:
  type: {{ .Values.service.type }}
  selector:
    app.kubernetes.io/name: {{ include "mychart.name" . }}
  ports:
    - name: http
      protocol: TCP
      port: {{ .Values.service.port }}
      targetPort: http-web-svc
```

```yaml:ingress.yaml
{{- if .Values.ingress.enabled }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "mychart.fullname" . }}-ingress
spec:
  ingressClassName: {{ .Values.ingress.className }}
  rules:
    {{- range .Values.ingress.hosts }}
    - host: {{ .host }}
      http:
        paths:
          {{- range .paths }}
          - path: {{ .path }}
            pathType: {{ .pathType }}
            backend:
              service:
                name: {{ include "mychart.fullname" $ }}-service
                port:
                  number: {{ $.Values.service.port }}
          {{- end }}
    {{- end }}
{{- end }}
```

### Ingress Controller ã‚’æœ‰åŠ¹åŒ–

```bash
minikube addons enable ingress
```

ä»¥ä¸‹ã§åæ˜ ãŒå®Œäº†ã—ãŸã‹ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
kubectl get pods -n ingress-nginx
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
helm install myapp .
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªï¼š

```bash
kubectl get all
kubectl get ingress
```

### hosts ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š

ä»¥ä¸‹ã®ã‚ˆã†ã« minikube ip ã‚’ä½¿ã£ã¦ example.local ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§è§£æ±ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™

```bash
minikube ip
```

/etc/hosts ã«ä»¥ä¸‹ã‚’è¿½è¨˜ï¼ˆmacOS / Linuxï¼‰ï¼š

```bash
192.168.49.2 example.local
```

### å‹•ä½œç¢ºèª

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿæ–½ã—ã¦ã€

```bash
minikube tunnel
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ <http://example.local> ã«ã‚¢ã‚¯ã‚»ã‚¹ã€‚Nginx ã®åˆæœŸç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

## ã¾ã¨ã‚

æœ¬è¨˜äº‹ã§ã¯ã€Kubernetesã®ä¸»è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã€Helmã®ä½¿ã„æ–¹ã®æ¦‚è¦ã¨ã€å®Ÿè·µã®èª¬æ˜ã‚’ã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ãŒã€èª­è€…ãŒã€€Kubernetesã«è§¦ã‚Œã‚‹éš›ã®ã€ç†è§£ã®ä¸€åŠ©ã«ãªã‚‹ã¨å¹¸ã„ã§ã™ã€‚
