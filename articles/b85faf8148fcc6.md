---
title: "Minikubeã§å‹•ã‹ã—ã¦å­¦ã¶Kubernetesã¨Helmå…¥é–€"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["kubernetes", "helm", "minikube"]
published: true
---

## ã¯ã˜ã‚ã«

æœ¬è¨˜äº‹ã¯ã€Kubernetesã¨Helmã«åˆã‚ã¦è§¦ã‚Œã‚‹æ–¹ã«å‘ã‘ãŸå…¥é–€è¨˜äº‹ã§ã™ã€‚åŸºæœ¬æ¦‚å¿µã®ç†è§£ã‹ã‚‰ã€minikubeã‚’ä½¿ã£ãŸãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã‚’æ‰±ã„ã¾ã™ã€‚

### ã“ã®è¨˜äº‹ã§å­¦ã¹ã‚‹ã“ã¨

- Kubernetesã®ä¸»è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆPodã€Deploymentã€Serviceã€Ingressï¼‰
- ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹
- Helmã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã®åŸºæœ¬
- minikubeã§ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ—ãƒ­ã‚¤

### å‰æçŸ¥è­˜

- Dockerã¨ã‚³ãƒ³ãƒ†ãƒŠã®åŸºæœ¬çš„ãªæ¦‚å¿µ
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œã®åŸºç¤

### Kubernetesã®å…¨ä½“åƒ

```mermaid
flowchart TB
    User[å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼] -->|HTTP| Ingress

    subgraph Cluster[Kubernetes Cluster]
        Ingress -->|ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°| Service
        Service -->|è² è·åˆ†æ•£| Pod1[Pod]
        Service -->|è² è·åˆ†æ•£| Pod2[Pod]

        subgraph Deployment[Deployment]
            Pod1
            Pod2
        end
    end
```

å¤–éƒ¨ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€Ingress â†’ Service â†’ Podã®é †ã«æµã‚Œã¾ã™ã€‚Deploymentã¯æŒ‡å®šã—ãŸæ•°ã®Podã‚’ç¶­æŒã—ã¾ã™ã€‚

## Kubernetes

Kubernetesã¯ã€ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã€é‹ç”¨ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

> Kubernetes is a portable, extensible, open source platform for managing containerized workloads and services, that facilitates both declarative configuration and automation.

<https://kubernetes.io/docs/concepts/overview/>

Kubernetesã‚’ä½¿ã†ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã“ã¨ãŒè‡ªå‹•åŒ–ã§ãã¾ã™ã€‚

- **ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ãƒ»åœæ­¢**: ã€ŒPodã‚’3ã¤èµ·å‹•ã™ã‚‹ã€ã¨å®šç¾©ã™ã‚Œã°ã€KubernetesãŒå¸¸ã«3ã¤ã‚’ç¶­æŒ
- **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: ã‚¢ã‚¯ã‚»ã‚¹å¢—åŠ æ™‚ã«Podã‚’å¢—ã‚„ã—ã€è½ã¡ç€ã„ãŸã‚‰æ¸›ã‚‰ã™
- **è‡ªå·±ä¿®å¾©**: PodãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¦ã‚‚ã€è‡ªå‹•ã§æ–°ã—ã„Podã‚’èµ·å‹•ã—ã¦å¾©æ—§

ã“ã‚Œã«ã‚ˆã‚Šã€å®‰å®šã—ãŸé‹ç”¨ã¨åŠ¹ç‡çš„ãªãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

## Kubernetes Objects

Kubernetesã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹æˆã‚’ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¨ã—ã¦å®šç¾©ã—ã¾ã™ã€‚ã€ŒPodã‚’3ã¤å‹•ã‹ã—ãŸã„ã€ã€Œå¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€ã¨ã„ã£ãŸæœ›ã¾ã—ã„çŠ¶æ…‹ã‚’è¨˜è¿°ã™ã‚‹ã¨ã€KubernetesãŒãã®çŠ¶æ…‹ã‚’ç¶­æŒã—ã¦ãã‚Œã¾ã™ã€‚

> Kubernetes objects are persistent entities in the Kubernetes system. Kubernetes uses these entities to represent the state of your cluster.

<https://kubernetes.io/docs/concepts/overview/working-with-objects/>

æœ¬è¨˜äº‹ã§æ‰±ã†ä¸»è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

| ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ       | èª¬æ˜                                         |
| ---------------- | -------------------------------------------- |
| **Pod**          | ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹æœ€å°å˜ä½ï¼ˆé€šå¸¸ã¯1ã‚³ãƒ³ãƒ†ãƒŠï¼‰ |
| **Deployment**   | Podã®æ•°ã‚’ç¶­æŒã—ã€æ›´æ–°ã‚„ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’ç®¡ç†     |
| **Service**      | Podã¸ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹         |
| **Ingress**      | å¤–éƒ¨ã‹ã‚‰ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’Serviceã¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ |

æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã‚Œã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’YAMLãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆï¼‰ã§å®šç¾©ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¯ã€Kubernetesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®šç¾©ã™ã‚‹YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã€Œã“ã†ã„ã†çŠ¶æ…‹ã«ã—ã¦ã»ã—ã„ã€ã¨ã„ã†è¨­å®šã‚’è¨˜è¿°ã—ã€Kubernetesã«é©ç”¨ã—ã¾ã™ã€‚

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ä½¿ã†åˆ©ç‚¹ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- **å®£è¨€çš„ãªç®¡ç†**: æœ›ã¾ã—ã„çŠ¶æ…‹ã‚’æ›¸ãã ã‘ã§ã€KubernetesãŒè‡ªå‹•ã§ç¶­æŒã—ã¦ãã‚Œã‚‹
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: YAMLãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§Gitã§å¤‰æ›´å±¥æ­´ã‚’è¿½è·¡ã§ãã‚‹
- **å†ç¾æ€§**: åŒã˜ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’é©ç”¨ã™ã‚Œã°ã€åˆ¥ã®ç’°å¢ƒã§ã‚‚åŒã˜æ§‹æˆã‚’å†ç¾ã§ãã‚‹

### ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®åŸºæœ¬æ§‹é€ 

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã«ã¯ä»¥ä¸‹ã®å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | èª¬æ˜                                                       |
|-----------------|-----------------------------------------------------------|
| **apiVersion**  | Kubernetes APIã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³                                 |
| **kind**        | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¨®é¡ï¼ˆDeploymentã€Serviceãªã©ï¼‰              |
| **metadata**    | ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåã‚„ãƒ©ãƒ™ãƒ«ãªã©ã®è­˜åˆ¥æƒ…å ±                       |
| **spec**        | æœ›ã¾ã—ã„çŠ¶æ…‹ï¼ˆPodæ•°ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ãªã©ï¼‰ã‚’è¨˜è¿°         |

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 2
  # Podã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆcontainersã€imageãªã©ï¼‰ã‚’å®šç¾©
```

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¯ `kubectl apply` ã‚³ãƒãƒ³ãƒ‰ã§Kubernetesã«é©ç”¨ã—ã¾ã™ã€‚

```bash
kubectl apply -f deployment.yaml
```

ã“ã‚Œã«ã‚ˆã‚Šã€Kubernetesã¯æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€æœ›ã¾ã—ã„çŠ¶æ…‹ã‚’ç¶­æŒã—ã¾ã™ã€‚

### Deployment

Deploymentã¯ã€Podã®èµ·å‹•ãƒ»ç¶­æŒãƒ»æ›´æ–°ã‚’ç®¡ç†ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

> A Deployment manages a set of Pods to run an application workload, usually one that doesn't maintain state.

<https://kubernetes.io/docs/concepts/workloads/controllers/deployment/>

Deploymentã‚’ä½¿ã†ã¨ã€ä»¥ä¸‹ã®ã“ã¨ãŒè‡ªå‹•åŒ–ã•ã‚Œã¾ã™ã€‚

- æŒ‡å®šã—ãŸæ•°ã®Podã‚’å¸¸ã«ç¶­æŒ
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ˆæ®µéšçš„ãªæ›´æ–°ï¼‰
- éšœå®³æ™‚ã®è‡ªå‹•å¾©æ—§

```yaml:deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: proxy
  template:
    metadata:
      labels:
        app.kubernetes.io/name: proxy
    spec:
      containers:
      - name: nginx
        image: nginx:stable
        ports:
        - containerPort: 80
          name: http-web-svc
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | èª¬æ˜                                                         |
|-----------------|-------------------------------------------------------------|
| **replicas**    | èµ·å‹•ã™ã‚‹Podã®æ•°                                              |
| **selector**    | ç®¡ç†å¯¾è±¡ã®Podã‚’è­˜åˆ¥ã™ã‚‹ãƒ©ãƒ™ãƒ«æ¡ä»¶                            |
| **template**    | ä½œæˆã™ã‚‹Podã®å®šç¾©ï¼ˆãƒ©ãƒ™ãƒ«ã€ã‚³ãƒ³ãƒ†ãƒŠã€ãƒãƒ¼ãƒˆãªã©ï¼‰            |

```bash
kubectl apply -f deployment.yaml
```

ã“ã‚Œã§DeploymentãŒä½œæˆã•ã‚Œã€æŒ‡å®šã—ãŸæ•°ã®PodãŒèµ·å‹•ã—ã¾ã™ã€‚

### Service

Serviceã¯ã€Podã¸ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

Podã¯å‹•çš„ã«ä½œæˆãƒ»å‰Šé™¤ã•ã‚Œã‚‹ãŸã‚ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚Serviceã‚’ä½¿ã†ã¨ã€å›ºå®šã®IPã‚„DNSåã§è¤‡æ•°ã®Podã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

> Expose an application running in your cluster behind a single outward-facing endpoint, even when the workload is split across multiple backends.

<https://kubernetes.io/docs/concepts/services-networking/service/>

```yaml:service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app.kubernetes.io/name: proxy
  ports:
  - name: name-of-service-port
    protocol: TCP
    port: 80
    targetPort: http-web-svc
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰       | èª¬æ˜                                               |
|------------------|---------------------------------------------------|
| **selector**     | å¯¾è±¡Podã‚’ãƒ©ãƒ™ãƒ«ã§æŒ‡å®šï¼ˆDeploymentã¨ä¸€è‡´ã•ã›ã‚‹ï¼‰    |
| **port**         | ServiceãŒå—ã‘ä»˜ã‘ã‚‹ãƒãƒ¼ãƒˆ                          |
| **targetPort**   | è»¢é€å…ˆã®Podã®ãƒãƒ¼ãƒˆï¼ˆåå‰ã¾ãŸã¯ç•ªå·ã§æŒ‡å®šï¼‰        |

```bash
kubectl apply -f service.yaml
```

ã“ã‚Œã§ServiceãŒä½œæˆã•ã‚Œã€Podã¸ã®å®‰å®šã—ãŸã‚¢ã‚¯ã‚»ã‚¹çµŒè·¯ãŒç¢ºä¿ã•ã‚Œã¾ã™ã€‚

### Ingress

Ingressã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿å¤–éƒ¨ã‹ã‚‰ã®HTTP/HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†…éƒ¨ã®Serviceã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ãƒ›ã‚¹ãƒˆåã‚„URLãƒ‘ã‚¹ã«åŸºã¥ã„ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚

> Make your HTTP (or HTTPS) network service available using a protocol-aware configuration mechanism, that understands web concepts like URIs, hostnames, paths, and more.

<https://kubernetes.io/docs/concepts/services-networking/ingress/>

```yaml:ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nginx-ingress
spec:
  ingressClassName: nginx
  rules:
    - host: example.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: nginx-service
                port:
                  number: 80
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰             | èª¬æ˜                                              |
|------------------------|--------------------------------------------------|
| **ingressClassName**   | ä½¿ç”¨ã™ã‚‹Ingress Controllerã‚’æŒ‡å®š                  |
| **rules**              | ãƒ›ã‚¹ãƒˆåãƒ»ãƒ‘ã‚¹ã”ã¨ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®šç¾©              |
| **backend.service**    | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è»¢é€å…ˆService                         |
| **pathType**           | ãƒ‘ã‚¹ã®ãƒãƒƒãƒæ–¹å¼ï¼ˆ`Prefix`: å‰æ–¹ä¸€è‡´ã€`Exact`: å®Œå…¨ä¸€è‡´ï¼‰ |

```bash
kubectl apply -f ingress.yaml
```

ã“ã‚Œã§IngressãŒä½œæˆã•ã‚Œã€å¤–éƒ¨ã‹ã‚‰Serviceã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

:::message
**Gateway APIã«ã¤ã„ã¦**
Kubernetesã§ã¯ã€Ingressã«ä»£ã‚ã‚‹æ–°ã—ã„APIã¨ã—ã¦Gateway APIãŒç™»å ´ã—ã¦ã„ã¾ã™ã€‚Ingress NGINX Controllerã¯2025å¹´11æœˆã«å»ƒæ­¢ãŒäºˆå‘Šã•ã‚Œã€2026å¹´3æœˆä»¥é™ã¯ã‚µãƒãƒ¼ãƒˆçµ‚äº†äºˆå®šã§ã™ã€‚æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯Gateway APIï¼ˆEnvoy Gatewayã€Ciliumç­‰ï¼‰ã®æ¡ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
<https://kubernetes.io/docs/concepts/services-networking/gateway/>
:::

## Helm

Kubernetesã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãŒè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†ã‹ã‚Œã¾ã™ã€‚ç’°å¢ƒã”ã¨ã«è¨­å®šã‚’å¤‰ãˆãŸã‚Šã€è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã§ä¼¼ãŸæ§‹æˆã‚’å†åˆ©ç”¨ã—ãŸã„å ´åˆã€ç®¡ç†ãŒç…©é›‘ã«ãªã‚ŠãŒã¡ã§ã™ã€‚

Helmã¯ã€Kubernetesãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã—ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ç®¡ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

> Helm helps you manage Kubernetes applications â€” Helm Charts help you define, install, and upgrade even the most complex Kubernetes application.

<https://helm.sh/>

## Helm Chart

Helm Chartã¯ã€Kubernetesã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ãŸã‚‚ã®ã§ã™ã€‚ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨è¨­å®šå€¤ã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã§ãã¾ã™ã€‚

> A Chart is a Helm package. It contains all of the resource definitions necessary to run an application, tool, or service inside of a Kubernetes cluster.

### ãƒãƒ£ãƒ¼ãƒˆã®æ§‹æˆ

```bash
mychart/
  Chart.yaml          # ãƒãƒ£ãƒ¼ãƒˆã®ãƒ¡ã‚¿æƒ…å ±ï¼ˆåå‰ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ï¼‰
  values.yaml         # è¨­å®šå€¤ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹ï¼‰
  templates/          # ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    deployment.yaml
    service.yaml
    ingress.yaml
```

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã¯ `{{ .Values.image.repository }}` ã®ã‚ˆã†ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æ–‡ã§å€¤ã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»æœ¬ç•ªãªã©ç’°å¢ƒã”ã¨ã«è¨­å®šã‚’å¤‰ãˆã¦ã€åŒã˜ãƒãƒ£ãƒ¼ãƒˆã‚’å†åˆ©ç”¨ã§ãã¾ã™ã€‚

## minikubeã§ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

ã“ã“ã¾ã§å­¦ã‚“ã å†…å®¹ã‚’ä½¿ã£ã¦ã€å®Ÿéš›ã«minikubeä¸Šã§Nginxã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

> minikube quickly sets up a local Kubernetes cluster on macOS, Linux, and Windows.

<https://minikube.sigs.k8s.io/docs/>

### minikubeã®èµ·å‹•

```bash
minikube start
```

ã‚¯ãƒ©ã‚¹ã‚¿ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
kubectl get nodes
```

### Helmãƒãƒ£ãƒ¼ãƒˆã®ä½œæˆ

```bash
helm create mychart
cd mychart
```

### values.yamlã‚’ç·¨é›†

values.yamlã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ãƒ³ãƒ—ãƒ«åŒ–ã—ã¾ã™ã€‚

```yaml:values.yaml
replicaCount: 2

image:
  repository: nginx
  tag: stable
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: true
  className: nginx
  hosts:
    - host: example.local
      paths:
        - path: /
          pathType: Prefix
```

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†

templates/é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®å†…å®¹ã§ç½®ãæ›ãˆã¾ã™ï¼ˆhelm createã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯è¤‡é›‘ãªãŸã‚ã€å­¦ç¿’ç”¨ã«ã‚·ãƒ³ãƒ—ãƒ«åŒ–ã—ã¦ã„ã¾ã™ï¼‰ã€‚

```yaml:deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "mychart.fullname" . }}-deployment
spec:
  replicas: {{ .Values.replicaCount | default 1 }}
  selector:
    matchLabels:
      app.kubernetes.io/name: {{ include "mychart.name" . }}
  template:
    metadata:
      labels:
        app.kubernetes.io/name: {{ include "mychart.name" . }}
    spec:
      containers:
        - name: {{ .Chart.Name }}
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - containerPort: {{ .Values.service.port }}
              name: http-web-svc

```

```yaml:service.yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ include "mychart.fullname" . }}-service
spec:
  type: {{ .Values.service.type }}
  selector:
    app.kubernetes.io/name: {{ include "mychart.name" . }}
  ports:
    - name: http
      protocol: TCP
      port: {{ .Values.service.port }}
      targetPort: http-web-svc
```

```yaml:ingress.yaml
{{- if .Values.ingress.enabled }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "mychart.fullname" . }}-ingress
spec:
  ingressClassName: {{ .Values.ingress.className }}
  rules:
    {{- range .Values.ingress.hosts }}
    - host: {{ .host }}
      http:
        paths:
          {{- range .paths }}
          - path: {{ .path }}
            pathType: {{ .pathType }}
            backend:
              service:
                name: {{ include "mychart.fullname" $ }}-service
                port:
                  number: {{ $.Values.service.port }}
          {{- end }}
    {{- end }}
{{- end }}
```

### Ingress Controllerã‚’æœ‰åŠ¹åŒ–

```bash
minikube addons enable ingress
```

åæ˜ ãŒå®Œäº†ã—ãŸã‹ç¢ºèªã—ã¾ã™ã€‚ã™ã¹ã¦ã®PodãŒ`Running`ã«ãªã‚‹ã¾ã§å¾…ã¡ã¾ã™ã€‚

```bash
kubectl get pods -n ingress-nginx --watch
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
helm install myapp .
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
kubectl get all
kubectl get ingress
```

### hostsãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š

minikubeã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã€example.localã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§è§£æ±ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```bash
minikube ip
```

/etc/hostsã«è¿½è¨˜ã—ã¾ã™ï¼ˆsudoæ¨©é™ãŒå¿…è¦ï¼‰ã€‚

```bash
echo "$(minikube ip) example.local" | sudo tee -a /etc/hosts
```

ã¾ãŸã¯æ‰‹å‹•ã§ç·¨é›†ã™ã‚‹å ´åˆã¯ã€`minikube ip`ã§å–å¾—ã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

```bash
sudo vi /etc/hosts
# ä»¥ä¸‹ã‚’è¿½è¨˜ï¼ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç’°å¢ƒã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ï¼‰
# 192.168.49.2 example.local
```

### å‹•ä½œç¢ºèª

åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ã€minikube tunnelã‚’èµ·å‹•ã—ã¾ã™ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

```bash
minikube tunnel
```

tunnelã¯èµ·å‹•ã—ãŸã¾ã¾ã«ã—ã¦ãŠãã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§ <http://example.local> ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Nginxã®åˆæœŸç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

## ã¾ã¨ã‚

æœ¬è¨˜äº‹ã§ã¯ã€ä»¥ä¸‹ã®å†…å®¹ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

- Kubernetesã®ä¸»è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆPodã€Deploymentã€Serviceã€Ingressï¼‰
- ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®åŸºæœ¬æ§‹é€ 
- Helmã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†
- minikubeã‚’ä½¿ã£ãŸãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤

Kubernetesã¯å­¦ã¶ã“ã¨ãŒå¤šã„ã§ã™ãŒã€ã¾ãšã¯æ‰‹ã‚’å‹•ã‹ã—ã¦è©¦ã—ã¦ã¿ã‚‹ã“ã¨ãŒç†è§£ã¸ã®è¿‘é“ã§ã™ã€‚ã“ã®è¨˜äº‹ãŒã€Kubernetesã‚’å­¦ã³å§‹ã‚ã‚‹æ–¹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
